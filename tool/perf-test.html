<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>
    <base href="..">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Ace Profile  util</title>
    <link rel="stylesheet" href="demo/kitchen-sink/styles.css" type="text/css" media="screen" charset="utf-8">
    <link href="../doc/site/images/favicon.ico" rel="icon" type="image/x-icon">
</head>
<body>
<div id="sidePanel" style="position:absolute;height:100%;">
<div class="toggleButton" id="optionToggle" role="button" aria-label="Hide Options" tabindex="0">
    <div></div><div></div><div></div>
</div>
  <div style="position: absolute; overflow: hidden; top:20px; bottom:0">
  <div style="width: 120%; height:100%; overflow-y: scroll">

  <table>
    <tr>
      <td colspan="2">
        <label for="profile">profile</label>
        <input type="checkbox" checked id="profile"></input>
        <label for="timeout">delay</label>
        <input id="timeout" type="text" value="3" style="width:10em"></input>
      </td>
    </tr>
    <tr>
      <td colspan="2">
        <button onclick = "start(this.textContent)">scroll</button>
        <button onclick = "start(this.textContent)">select</button>
        <button onclick = "start(this.textContent)">type</button>
        <button onclick = "start(this.textContent)">selectH</button>
      </td>
    </tr>
    <tr>
      <td colspan="2">
        <button onclick = "start(this.textContent)">tokenize</button>
      </td>
    </tr>

  </table>
  <div id="optionsPanel"></div>

  </div>
  </div>
</div>
  <div id="editor-container"></div>

<!--DEVEL-->
  <script type="text/javascript">
      var require = {
          baseUrl: window.location.protocol + "//" + window.location.host + window.location.pathname.split("/").slice(0, -1).join("/"),
          paths: {
              ace: "../lib/ace"
          }
      };
  </script>
  <script src="demo/kitchen-sink/require.js" data-main="../demo/kitchen-sink/demo" type="text/javascript"></script>
  <script>
    var useLib = /lib=1/.test(location.search);
    var paths = useLib ? {
      ace: "../lib/ace",
      demo: "../demo/kitchen-sink"
    } : {
      ace: "../src",
      demo: "../demo/kitchen-sink",
      "ace/worker/worker_client": "../lib/ace/worker/worker_client_v2",
      "ace/worker": "../lib/ace/worker",
    };
    
    if (!useLib) {
      [
        "json_worker",
        "xquery_worker",
        "yaml_worker",
        "xquery/xqlint",
        "xquery/jsoniq_lexer",
        "xquery/xquery_lexer",
        "css/csslint",
        "coffee_worker",
        "css_worker",
        "xquery",
        "html/saxparser",
        "php/php",
        "lua/luaparse",
        "xml/sax",
        "xml/dom-parser",
        "xml/dom",
        "lua_worker",
        "jsoniq",
        "json/json_parse",
        "xml_worker",
        "coffee/coffee",
        "javascript_worker",
        "php_worker",
        "yaml/yaml-lint",
        "javascript/jshint",
        "html_worker",
      ].forEach(function(m) {
        paths["ace/mode/" + m] = "../lib/ace/mode/" + m
      })
    }
    
    require.config({
        paths: paths
    });
    require(["ace/ace"], function (ace) {
        require(["demo/demo.js"], function (demo) {
        });
    });
  </script>

  <script>(function() {
    if (!Date.now) {
        Date.now = function() { return (new Date()).getTime() };
    }

    var scrollTop, startTime;
    var timeout, speed, next
    var editor, shouldProfile;
    var tests = {}

    function start(testName) {
        editor = env.editor
        timeout = parseInt(document.getElementById("timeout").value);
        shouldProfile = document.getElementById("profile").checked;

        startTime = Date.now()
        shouldProfile && console.profile()

        speed = 10;
        next = tests[testName + "Next"];

        tests[testName + "Start"] && tests[testName + "Start"]()
        setTimeout(next, 1);
    }
    function end(){
        shouldProfile && console.profileEnd()
        var dt = startTime - Date.now()
        console.log(dt)
        editor.cmdLine.setValue(dt+"", 1)
    }

    /*editor.renderer.scrollToY(0);
    editor.navigateFileStart(0);
    */

    tests.scrollNext = function() {
        var r = editor.renderer
        for (var i = speed; i--; )
            r.scrollBy(0, 1)
        if (r.scrollTop + r.layerConfig.height > r.layerConfig.maxHeight - 20)
            end()
        else
            setTimeout(next, timeout, speed++)
    }

    tests.selectNext = function() {
        var r = editor.renderer
        for (var i = speed; i-- > 0; )
            editor.selection.selectDown()
        editor.renderer.scrollCursorIntoView()
        if (r.scrollTop + r.layerConfig.height > r.layerConfig.maxHeight - 20)
            end()
        else
            setTimeout(next, timeout, speed+=0.1)
    }

    tests.selectHNext = function() {
        var r = editor.renderer
        for (var i = speed; i-- > 0; )
            editor.selection.selectRight()
        if (r.scrollTop + r.layerConfig.height > r.layerConfig.maxHeight - 20)
            end()
        else
            setTimeout(next, timeout, speed+=0.1)
    }

    var typeChars = start.toString().split("")
    tests.typeNext = function() {
        var r = editor.renderer
        for (var i = speed; i--; )
            editor.insert(typeChars[i % typeChars.length])
        if (speed == 100)
            end()
        else
            setTimeout(next, timeout, speed++)
    }

    var tokenizer, state, lines, chunk
    tests.tokenizeStart = function() {
        var b = editor.session.bgTokenizer
        state = null
        tokenizer = b.tokenizer
        lines = b.doc.getAllLines()
        chunk = 1000
    }
    
    tests.tokenizeNext = function() {
        var states = []
        for (var i = 0, l = lines.length; i < l; i++) {
            state = tokenizer.getLineTokens(lines[i], state).state
        }
        states.push(state)
        if (speed-- > 3)
            setTimeout(next, timeout)
        else
            end()
    }

    window.start = start;
}())
  </script>

</body>
</html>
